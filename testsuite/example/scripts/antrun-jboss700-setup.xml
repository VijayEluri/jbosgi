<?xml version="1.0" encoding="UTF-8"?>

<!-- ============================================================ -->
<!--  JBoss, the OpenSource J2EE webOS                            -->
<!--  Distributable under LGPL license.                           -->
<!--  See terms of license at http://www.gnu.org.                 -->
<!-- ============================================================ -->

<project default="jboss-as-setup">

  <description>Sets up JBoss AS for test suite</description>

  <!-- ================================================================== -->
  <!-- Init                                                               -->
  <!-- ================================================================== -->

  <target name="check-config" unless="jboss.home">
    <echo>
Please specify JBoss AS 7 root directory in property 'jboss.home'
For example:
             -Djboss.home=/clones/jbosgi-as/build/target
    </echo>
  </target>

  <target name="jboss-as-setup" depends="check-config" if="jboss.home">
    <antcall target="copy-file">
      <param name="file" value="arquillian-osgi-bundle.jar"/>
    </antcall>
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-blueprint.jar"/>
    </antcall>      
  	<antcall target="copy-file">
      <param name="file" value="jboss-osgi-common-core.jar"/>
    </antcall>  	
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-http.jar"/>
    </antcall>
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-jaxb.jar"/>
    </antcall>
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-reflect.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-webapp.jar"/>
    </antcall>
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-webconsole.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="jboss-osgi-xerces.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="org.apache.felix.configadmin.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="org.apache.felix.eventadmin.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="org.apache.felix.log.jar"/>
    </antcall>      
    <antcall target="copy-file">
      <param name="file" value="org.apache.felix.metatype.jar"/>
    </antcall>      
  </target>

  <target name="copy-file">
    <echo message="Bundle: ${file}"/>

    <condition property="file.exist">
      <or>
        <available file="${jboss.home}/standalone/deployments/${file}"/>
        <available file="${jboss.home}/standalone/deployments/${file}.deployed"/>
      </or>
    </condition>
    <antcall target="copy-if-not-exist"/>
  </target>
	
  <target name="copy-if-not-exist" unless="file.exist">
    <copy file="target/test-libs/bundles/${file}"
          toDir="${jboss.home}/standalone/deployments"/>
  </target>
</project>
