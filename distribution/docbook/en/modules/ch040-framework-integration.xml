<!-- 
  $Id$ 
-->
<chapter xml:id="ChapFrameworkIntegration">

  <title>Framework Integration</title>
  
  <sect1 xml:id="SecIntegrationJBossMC">  
    <title>JBossMC Framework Integration</title>
    
    <para>Starting from 1.0.0.Beta4 JBoss OSGi provides integration for our native <ulink url="http://www.jboss.org/jbossmc/">Microcontainer based</ulink>
     OSGi Framework. When deployed in JBossAS this Framework will eventually allow us to integrate with components from other programming models.
     (i.e. OSGi services can access MC beans, EJB3 can access OSGi services and vice versa)</para>

    <para>JBossMC integration can be configured through an XML beans configuration in the <link linkend="ChapRuntime">JBoss OSGi Runtime</link>.</para>
    
    <programlisting role="XML"><![CDATA[
cat server/default/conf/jboss-osgi-bootstrap.xml 

<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- The OSGiFramework -->
  <bean name="OSGiBundleManager" class="org.jboss.osgi.framework.bundle.OSGiBundleManager">
  <property name="properties">
    ...
  </property>
  </bean>
...
</deployment>
    ]]></programlisting>
    
    <para>In the <ulink url="http://www.jboss.org/jbossas">JBossAS</ulink> integration we also use 
    <ulink url="http://www.jboss.org/jbossmc">JBoss Microcontainer</ulink> beans configuration.</para>
    
  </sect1>
  
  <sect1 xml:id="SecIntegrationFelix">  
    <title>Apache Felix Integration</title>
    
    <para>JBoss OSGi provides integration for the <ulink url="http://felix.apache.org">Apache Felix</ulink> OSGi Framework and some
    of its core services</para>

    <itemizedlist>
      <listitem><ulink url="http://felix.apache.org/site/apache-felix-log-service.html">Log Service</ulink> - General purpose message logger</listitem>
      <listitem><ulink url="http://felix.apache.org/site/apache-felix-configuration-admin-service.html">Config Admin Service</ulink> - Management of configuration data for configurable components</listitem>
    </itemizedlist>

    <para>The Apache Felix integration can be configured through properties in the <link linkend="ChapRuntime">JBoss OSGi Runtime</link>.
    </para>
    
    <programlisting>
cat conf/jboss-osgi-framework.properties 

# Properties to configure the Framework
org.osgi.framework.storage=${osgi.server.home}/data/osgi-store
org.osgi.framework.storage.clean=onFirstInit

# Hot Deployement
org.jboss.osgi.hotdeploy.scandir=${osgi.server.home}/bundles

...

# Bundles that need to be installed with the Framework automatically 
org.jboss.osgi.spi.framework.autoInstall=\
  file://${osgi.home}/server/minimal/bundles/org.osgi.compendium.jar

# Bundles that need to be started automatically 
org.jboss.osgi.spi.framework.autoStart=\
   file://${osgi.home}/server/minimal/bundles/org.apache.felix.log.jar \
   file://${osgi.home}/server/minimal/bundles/jboss-osgi-common.jar \
   file://${osgi.home}/server/minimal/bundles/jboss-osgi-hotdeploy.jar
    </programlisting>
    
    <para>In the <ulink url="http://www.jboss.org/jbossas">JBossAS</ulink> integration we use 
    <ulink url="http://www.jboss.org/jbossmc">JBoss Microcontainer</ulink> beans configuration.</para>
    
    <programlisting role="XML"><![CDATA[
cat server/default/deployers/osgi.deployer/META-INF/osgi-deployers-jboss-beans.xml 

<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- The OSGiFramework -->
  <bean name="jboss.osgi:service=Framework" class="org.jboss.osgi.felix.FelixIntegration">
    <property name="properties">
       ...
    </property>
    <property name="autoStart">
     <list elementClass="java.net.URL">
      ...
     </list>
    </property>
  </bean>
  ...
</deployment>
    ]]></programlisting>

    <para>The following is a description of the configuration properties for the Apache Felix integration.</para>
    
    <table>
      <tr><th>Key</th><th>Value</th><th>Description</th></tr>
      <tr valign="top">
        <td>org.osgi.framework.storage</td>
        <td>.../osgi-store</td>
        <td>OSGi Framework storage area</td>
      </tr>
      <tr valign="top">
        <td>org.osgi.framework.storage.clean</td>
        <td>onFirstInit</td>
        <td>Clean the storage area on first init</td>
      </tr>
      <tr valign="top">
        <td>org.osgi.service.http.port</td>
        <td>8090</td>
        <td>The default Http Service port</td>
      </tr>
      <tr valign="top">
        <td>felix.cm.dir</td>
        <td>.../osgi-configadmin</td>
        <td>Config Admin Service storage area</td>
      </tr>
      <tr valign="top">
        <td>org.osgi.framework.system.packages.extra</td>
        <td>javax.management, javax.xml...</td>
        <td>Packages provided by the OSGi System ClassLoader</td>
      </tr>
      <tr valign="top">
        <td>org.jboss.osgi.deferred.start</td>
        <td>true</td>
        <td>Bundles can be deployed in any order</td>
      </tr>
    </table>
  </sect1>
  
  <sect1 xml:id="SecIntegrationEquinox">  
    <title>Equinox Integration</title>
    
    <para>JBoss OSGi also provides basic integration for the <ulink url="http://www.eclipse.org/equinox">Eclipse Equinox</ulink> OSGi Framework.</para>
    
    <para>Equinox integration can be configured through properties in the <link linkend="ChapRuntime">JBoss OSGi Runtime</link>.</para>
    
    <programlisting role="XML"><![CDATA[
cat conf/jboss-osgi-framework.properties 

# Properties to configure the Framework
org.osgi.framework.storage=${osgi.server.home}/data/osgi-store
org.osgi.framework.storage.clean=onFirstInit

# Hot Deployement
org.jboss.osgi.hotdeploy.scandir=${osgi.server.home}/bundles

...

# Bundles that need to be installed with the Framework automatically 
org.jboss.osgi.spi.framework.autoInstall=\
 file://${osgi.home}/server/minimal/deploy/org.eclipse.osgi.services.jar \
 file://${osgi.home}/server/minimal/deploy/org.eclipse.osgi.util.jar

# Bundles that need to be started automatically 
org.jboss.osgi.spi.framework.autoStart=\
   file://${osgi.home}/server/minimal/bundles/org.apache.felix.log.jar \
   file://${osgi.home}/server/minimal/bundles/jboss-osgi-common.jar \
   file://${osgi.home}/server/minimal/bundles/jboss-osgi-hotdeploy.jar
    ]]></programlisting>
    
    <para>In the <ulink url="http://www.jboss.org/jbossas">JBossAS</ulink> integration we use 
    <ulink url="http://www.jboss.org/jbossmc">JBoss Microcontainer</ulink> beans configuration.</para>
    
    <programlisting role="XML"><![CDATA[
<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- The OSGiFramework -->
  <bean name="jboss.osgi:service=Framework" class="org.jboss.osgi.equinox.EquinoxIntegration">
    <property name="properties">
       ...
    </property>
    <property name="autoStart">
     <list elementClass="java.net.URL">
      ...
     </list>
    </property>
  </bean>
  ...
</deployment>
    ]]></programlisting>
    
  </sect1>
  
</chapter>
