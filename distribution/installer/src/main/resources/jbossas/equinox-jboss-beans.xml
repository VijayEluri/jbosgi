<?xml version="1.0" encoding="UTF-8"?>

<!--
  $Id$
-->

<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- 
  ********************************
  *                              *  
  *  Framework                   *
  *                              *
  ********************************
  -->

  <!-- The OSGiFramework -->
  <bean name="jboss.osgi:service=Framework" class="org.jboss.osgi.equinox.EquinoxIntegration">
    <property name="properties">
      <map keyClass="java.lang.String" valueClass="java.lang.String">
        <entry><key>org.osgi.framework.storage</key><value>${jboss.server.data.dir}/osgi-store</value></entry>
        <entry><key>org.osgi.framework.storage.clean</key><value>onFirstInit</value></entry>
        <entry><key>org.osgi.service.http.port</key><value>8090</value></entry>
        <entry><key>osgi.framework</key><value>${jboss.server.home.url}/deployers/osgi.deployer/org.eclipse.osgi.jar</value></entry>
        <entry><key>osgi.install.area</key><value>${jboss.server.data.dir}/equinox</value></entry>
        <entry>
          <key>org.osgi.framework.system.packages.extra</key>
          <value>
            <!-- system -->
            javax.transaction;version=1.0,
            javax.xml.bind.annotation;version=2.1,
            org.apache.xerces.dom;version=2.9,
            org.jnp.interfaces;version=5.0,
            
            <!-- logging -->  
            org.apache.log4j;version=1.2,
            org.jboss.logging;version=2.1,

            <!-- jboss -->          
            org.jboss.net.protocol;version=2.2,
            org.jboss.virtual;version=2.1,
            org.jboss.virtual.plugins.registry;version=2.1,
            org.jboss.virtual.plugins.context.jar;version=2.1,
            org.jboss.virtual.plugins.vfs.helpers;version=2.1,
            org.jboss.virtual.protocol;version=2.1,
          
            <!-- jboss-osgi  -->          
            org.jboss.osgi.deployment.common;version=1.0,
            org.jboss.osgi.deployment.deployer;version=1.0,
            org.jboss.osgi.deployment.interceptor;version=1.0,
            org.jboss.osgi.spi;version=1.0,
            org.jboss.osgi.spi.capability;version=1.0,
            org.jboss.osgi.spi.framework;version=1.0,
            org.jboss.osgi.spi.service;version=1.0,
            org.jboss.osgi.spi.util;version=1.0,
            org.jboss.osgi.testing;version=1.0,
            org.jboss.osgi.vfs;version=1.0,
            
            <!-- org.osgi -->
            org.osgi.framework;version=1.5
          </value>
        </entry>
        <!-- 
          If set to 'true' bundles can be deployed in any order. Deployed bundle will get started when their dependencies can be resolved.
          If set to 'false' bundles must be deployed in the order that is required to start them. 
        -->
        <entry><key>org.jboss.osgi.deferred.start</key><value>true</value></entry>
        <!-- Husky socket connector properties -->
        <entry><key>org.jboss.osgi.husky.runtime.connector.host</key><value>${jboss.bind.address}</value></entry>
        <entry><key>org.jboss.osgi.husky.runtime.connector.port</key><value>5401</value></entry>
        <!-- HTTP Service Port -->
        <entry><key>org.osgi.service.http.port</key><value>8090</value></entry>
        <!-- Config Admin Service -->
        <entry><key>felix.cm.dir</key><value>${jboss.server.data.dir}/osgi-configadmin</value></entry>
        <!-- JMX bundle properties -->
        <entry><key>org.jboss.osgi.jmx.host</key><value>${jboss.bind.address}</value></entry>
        <!-- JNDI bundle properties -->
        <entry><key>org.jboss.osgi.jndi.host</key><value>${jboss.bind.address}</value></entry>
        <!-- JTA Object Store -->
        <entry><key>com.arjuna.ats.arjuna.objectstore.objectStoreDir</key><value>${jboss.server.data.dir}/tx-object-store</value></entry>
      </map>
    </property>
    <property name="autoInstall">
     <list elementClass="java.net.URL">
      <value>${jboss.server.home.url}/deploy/osgi/org.eclipse.osgi.services.jar</value>
     </list>
    </property>
    <property name="autoStart">
     <list elementClass="java.net.URL">
      <value>${jboss.server.home.url}/deploy/osgi/org.apache.felix.log.jar</value>
      <value>${jboss.server.home.url}/deploy/osgi/jboss-osgi-common.jar</value>
     </list>
    </property>
  </bean>

  <!-- 
  ********************************
  *                              *  
  *  Deployers                   *
  *                              *
  ********************************
  -->

  <bean name="BundleClassLoaderDeployer" class="org.jboss.osgi.deployer.BundleClassLoaderDeployer">
    <property name="systemContext"><inject bean="jboss.osgi:service=Framework" property="bundleContext" /></property>
  </bean>
  <bean name="BundleManifestParsingDeployer" class="org.jboss.osgi.deployer.BundleManifestParsingDeployer" />
  <bean name="BundleRealDeployer" class="org.jboss.osgi.deployer.BundleRealDeployer">
    <property name="systemContext"><inject bean="jboss.osgi:service=Framework" property="bundleContext" /></property>
    <property name="skipBundles"><inject bean="jboss.osgi:service=Framework" property="autoInstall" /></property>
  </bean>
  <bean name="BundleStartLevelDeployer" class="org.jboss.osgi.deployer.BundleStartLevelDeployer">
    <property name="systemContext"><inject bean="jboss.osgi:service=Framework" property="bundleContext" /></property>
  </bean>
  <bean name="BundleStartStopDeployer" class="org.jboss.osgi.deployer.BundleStartStopDeployer">
    <property name="systemContext"><inject bean="jboss.osgi:service=Framework" property="bundleContext" /></property>
  </bean>
  <bean name="BundleStructureDeployer" class="org.jboss.osgi.deployer.BundleStructureDeployer" />

</deployment>