<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<installation version="1.0">
  <!-- 
    Ant properties in this file can be referenced with @{},
    otherwise use variables below in installer files with ${} 
  -->
  <info>
    <appname>JBoss OSGi</appname>
    <appversion>@{product.version}</appversion>
    <uninstaller name="remove.task" write="yes" />
  </info>
  <guiprefs width="600" height="440" resizable="yes">
    <!--
    <laf name="kunststoff">
      <os family="unix" />
    </laf>
    -->
  </guiprefs>
  <locale>
    <langpack iso3="eng" />
  </locale>
  
  <!-- jars -->
  <jar src="@{deploy.artifacts.dir}/lib/ant.jar" stage="both" />
  <jar src="@{deploy.artifacts.dir}/lib/ant-launcher.jar" stage="both" />
  
  <!-- Listeners -->
  <listeners>
    <listener installer="AntActionInstallerListener" uninstaller="AntActionUninstallerListener" />
  </listeners>

  <!-- Resources -->
  <resources>
    <res id="AntActionsSpec.xml" src="@{filtered.resources.dir}/ant-actions-spec.xml" />
    <res id="antBuild.xml" src="@{filtered.resources.dir}/ant-jbossas-integration.xml" type="ant"/>
    <res id="userInputSpec.xml" src="@{filtered.resources.dir}/user-input-spec.xml" />
    <res id="TargetPanel.dir" src="@{filtered.resources.dir}/target-panel-dir.txt" />
  </resources>

  <!-- Variables -->
  <variables>
    <variable name="jboss600.home" value="@{jboss600.home}" />
    <variable name="jboss601.home" value="@{jboss601.home}" />
  </variables>

  <!-- Dynamic Variables -->
  <dynamicvariables>
    <variable name="jboss.home" value="${jboss600.home}" condition="isJBoss600" />
    <variable name="jboss.home" value="${jboss601.home}" condition="isJBoss601" />
  </dynamicvariables>

  <!-- Conditions -->
  <conditions>
    <condition type="variable" id="isJBoss600">
      <name>jbossSelection</name>
      <value>jboss600</value>
    </condition>
    <condition type="variable" id="isJBoss601">
      <name>jbossSelection</name>
      <value>jboss601</value>
    </condition>
    <condition type="variable" id="isServerMinimal">
      <name>jbossTargetServer</name>
      <value>minimal</value>
    </condition>
  </conditions>

  <!-- Panels -->
  <panels>
    <panel classname="HelloPanel" />
    <panel classname="TargetPanel" />
    <panel classname="TreePacksPanel" />
    <panel classname="UserInputPanel" id="jbossas.select.jbossmc" />
    <panel classname="UserInputPanel" id="jboss.home.select" />
    <panel classname="SummaryPanel" />
    <panel classname="InstallPanel" />
    <panel classname="FinishPanel" />
  </panels>

  <!-- Packs -->
  <packs>

    <!--
      ********************************
      *                              *
      * JBossOSGi Distribution       *
      *                              *
      ********************************
    -->

    <pack name="JBoss OSGi Distribution" required="yes">

      <description>Documentation, Binary Artifacts and Sources</description>

      <!-- JBossOSGi -->
      <fileset dir="@{deploy.artifacts.dir}/etc" targetdir="$INSTALL_PATH" override="true">
        <include name="JBossORG-EULA.txt" />
        <include name="ReleaseNotes.html" />
      </fileset>

      <!-- JBossOSGi Docs -->
      <fileset dir="@{deploy.artifacts.dir}/docs/userguide" targetdir="$INSTALL_PATH/docs/userguide" override="true" />
      <file src="@{deploy.artifacts.dir}/lib/jboss-osgi-javadoc-javadoc.jar" targetdir="$INSTALL_PATH/docs/apidocs" unpack="true" override="true" />

      <!-- JBossOSGi Examples -->
      <file src="@{deploy.artifacts.dir}/lib/jboss-osgi-testsuite-example.zip" targetdir="$INSTALL_PATH" unpack="true" override="true" />

      <!-- JBossOSGi Source -->
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/source" override="true">
        <include name="jbosgi-resolver-api-sources.jar" />
        <include name="jbosgi-resolver-spi-sources.jar" />
        <include name="jbosgi-resolver-felix-sources.jar" />
        <include name="jbosgi-resolver-metadata-sources.jar" />
        <include name="jboss-osgi-xerces-sources.jar" />
        <include name="jboss-osgi-blueprint-sources.jar" />
        <include name="jboss-osgi-common-core-sources.jar" />
        <include name="jboss-osgi-common-sources.jar" />
        <include name="jboss-osgi-deployment-sources.jar" />
        <include name="jboss-osgi-equinox-sources.jar" />
        <include name="jboss-osgi-felix-sources.jar" />
        <include name="jboss-osgi-framework-sources.jar" />
        <include name="jboss-osgi-framework-core-sources.jar" />
        <include name="jboss-osgi-framework-metadata-sources.jar" />
        <include name="jboss-osgi-framework-resolver-sources.jar" />
        <include name="jboss-osgi-hotdeploy-sources.jar" />
        <include name="jboss-osgi-husky-harness-sources.jar" />
        <include name="jboss-osgi-jaxb-sources.jar" />
        <include name="jboss-osgi-jbossas-sources.jar" />
        <include name="jboss-osgi-jmx-sources.jar" />
        <include name="jboss-osgi-jndi-sources.jar" />
        <include name="jboss-osgi-jta-sources.jar" />
        <include name="jboss-osgi-reflect-sources.jar" />
        <include name="jboss-osgi-spi-sources.jar" />
        <include name="jboss-osgi-webapp-sources.jar" />
        <include name="jboss-osgi-webconsole-sources.jar" />
        <include name="jboss-osgi-xml-binding-sources.jar" />
      </fileset>

    </pack>

    <!--
      ********************************
      *                              *
      * JBossOSGi Runtime            *
      *                              *
      ********************************
    -->

    <pack name="JBoss OSGi Runtime" required="no" preselected="yes">

      <description>Standalone JBossOSGi Runtime</description>

      <!-- JBossOSGi Bin -->
      <fileset dir="@{runtime.dir}/bin" targetdir="$INSTALL_PATH/runtime/bin" override="true" />
      <executable targetfile="$INSTALL_PATH/runtime/bin/run.sh" stage="never" keep="true" />

      <!-- JBossOSGi conf -->
      <fileset dir="@{runtime.dir}/conf" targetdir="$INSTALL_PATH/runtime/conf/META-INF/services" override="true">
        <include name="org.jboss.osgi.spi.framework.OSGiBootstrapProvider" />
      </fileset>

      <!-- JBossOSGi Lib -->
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/runtime/lib" override="true">
        <include name="args4j.jar" />
        <include name="javax.inject.jar" />
        <include name="jaxb-api.jar" />
        <include name="jbosgi-resolver-api.jar" />
        <include name="jbosgi-resolver-spi.jar" />
        <include name="jbosgi-resolver-felix.jar" />
        <include name="jbosgi-resolver-metadata.jar" />
        <include name="jboss-classloader.jar" />
        <include name="jboss-classloading.jar" />
        <include name="jboss-classloading-spi.jar" />
        <include name="jboss-classloading-vfs.jar" />
        <include name="jboss-common-core.jar" />
        <include name="jboss-dependency.jar" />
        <include name="jboss-deployers-client.jar" />
        <include name="jboss-deployers-client-spi.jar" />
        <include name="jboss-deployers-core.jar" />
        <include name="jboss-deployers-core-spi.jar" />
        <include name="jboss-deployers-impl.jar" />
        <include name="jboss-deployers-spi.jar" />
        <include name="jboss-deployers-structure-spi.jar" />
        <include name="jboss-deployers-vfs.jar" />
        <include name="jboss-deployers-vfs-spi.jar" />
        <include name="jboss-kernel.jar" />
        <include name="jboss-logging-spi.jar" />
        <include name="jboss-logging-log4j.jar" />
        <include name="jboss-managed.jar" />
        <include name="jboss-mdr.jar" />
        <include name="jboss-metatype.jar" />
        <include name="jboss-osgi-deployment.jar" />
        <include name="jboss-osgi-framework.jar" />
        <include name="jboss-osgi-framework-core.jar" />
        <include name="jboss-osgi-framework-metadata.jar" />
        <include name="jboss-osgi-framework-resolver.jar" />
        <include name="jboss-osgi-spi.jar" />
        <include name="jboss-osgi-vfs.jar" />
        <include name="jboss-osgi-vfs30.jar" />
        <include name="jboss-reflect.jar" />
        <include name="jboss-vfs.jar" />
        <include name="jbossxb.jar" />
        <include name="log4j.jar" />
        <include name="mcann-core.jar" />
        <include name="scanning-plugins.jar" />
        <include name="scanning-spi.jar" />
        <include name="scanning-impl.jar" />
        <include name="shrinkwrap-api.jar" />
        <include name="slf4j-api.jar" />
        <include name="slf4j-log4j12.jar" />
        <include name="xercesImpl.jar" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib/org.osgi" targetdir="$INSTALL_PATH/runtime/lib" override="true">
        <include name="org.osgi.core.jar" />
      </fileset>
      
      <!-- Server Minimal -->
      <fileset dir="@{runtime.dir}/server/minimal/conf" targetdir="$INSTALL_PATH/runtime/server/minimal/conf" override="true" >
        <include name="jboss-osgi-bootstrap.xml" />
        <include name="log4j.xml" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/runtime/server/minimal/deploy" override="true">
        <include name="org.apache.felix.log.jar" />
        <include name="jboss-osgi-common.jar" />
        <include name="jboss-osgi-hotdeploy.jar" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib/org.osgi" targetdir="$INSTALL_PATH/runtime/server/minimal/deploy" override="true">
        <include name="org.osgi.compendium.jar" />
      </fileset>

      <!-- Server Default -->
      <fileset dir="@{runtime.dir}/server/default/conf" targetdir="$INSTALL_PATH/runtime/server/default/conf" override="true" >
        <include name="jboss-osgi-bootstrap.xml" />
        <include name="log4j.xml" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/runtime/server/default/deploy" override="true">
        <!-- default -->
        <include name="jboss-osgi-common-core.jar" />
        <include name="jboss-osgi-jmx.jar" />
        <include name="jboss-osgi-jndi.jar" />
        <include name="org.apache.felix.configadmin.jar" />
        <include name="org.apache.felix.eventadmin.jar" />
        <include name="org.apache.aries.jmx.jar" />
        <include name="org.apache.aries.util.jar" />
      </fileset>

      <!-- Server Web -->
      <fileset dir="@{runtime.dir}/server/default/conf" targetdir="$INSTALL_PATH/runtime/server/web/conf" override="true" >
        <include name="jboss-osgi-bootstrap.xml" />
        <include name="log4j.xml" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/runtime/server/web/deploy" override="true">
        <!-- default -->
        <include name="jboss-osgi-common-core.jar" />
        <include name="jboss-osgi-jmx.jar" />
        <include name="jboss-osgi-jndi.jar" />
        <include name="org.apache.felix.configadmin.jar" />
        <include name="org.apache.felix.eventadmin.jar" />
        <include name="org.apache.aries.jmx.jar" />
        <include name="org.apache.aries.util.jar" />
        <!-- web -->
        <include name="org.apache.felix.metatype.jar" />
        <include name="jboss-osgi-http.jar" />
        <include name="jboss-osgi-webapp.jar" />
        <include name="jboss-osgi-webconsole.jar" />
      </fileset>

      <!-- Server All -->
      <fileset dir="@{runtime.dir}/server/default/conf" targetdir="$INSTALL_PATH/runtime/server/all/conf" override="true" >
        <include name="jboss-osgi-bootstrap.xml" />
        <include name="log4j.xml" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="$INSTALL_PATH/runtime/server/all/deploy" override="true">
        <!-- default -->
        <include name="jboss-osgi-common-core.jar" />
        <include name="jboss-osgi-jmx.jar" />
        <include name="jboss-osgi-jndi.jar" />
        <include name="org.apache.felix.configadmin.jar" />
        <include name="org.apache.felix.eventadmin.jar" />
        <include name="org.apache.aries.jmx.jar" />
        <include name="org.apache.aries.util.jar" />
        <!-- web -->
        <include name="org.apache.felix.metatype.jar" />
        <include name="jboss-osgi-http.jar" />
        <include name="jboss-osgi-webapp.jar" />
        <include name="jboss-osgi-webconsole.jar" />
        <!-- all -->
        <include name="jboss-osgi-xerces.jar" />
        <include name="jboss-osgi-blueprint.jar" />
        <include name="jboss-osgi-husky.jar" />
        <include name="jboss-osgi-jaxb.jar" />
        <include name="jboss-osgi-jta.jar" />
        <include name="jboss-osgi-reflect.jar" />
        <include name="jboss-osgi-xml-binding.jar" />
      </fileset>

    </pack>

    <!--
      ********************************* 
      *                               *
      * JBossAS Integration           *
      *                               *
      *********************************
    -->

    <pack name="JBossAS Integration" required="no" preselected="yes">

      <description>Integration with an existing JBossAS instance</description>

      <fileset condition="isJBoss601" dir="@{deploy.artifacts.dir}/resources/jbossas/jboss600" 
        targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deploy" override="true">
        <include name="jboss-logging.xml" />
      </fileset>
      
      <!-- lib -->
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="${jbossInstallPath}/lib" override="true">
        <include name="jboss-osgi-framework-metadata.jar" />
      </fileset>
      
      <!-- deployers/osgi.deployer -->
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deployers/osgi.deployer" override="true">
        <include name="jbosgi-resolver-api.jar" />
        <include name="jbosgi-resolver-spi.jar" />
        <include name="jbosgi-resolver-felix.jar" />
        <include name="jbosgi-resolver-metadata.jar" />
        <include name="jboss-osgi-deployment.jar" />
        <include name="jboss-osgi-framework.jar" />
        <include name="jboss-osgi-framework-core.jar" />
        <include name="jboss-osgi-framework-resolver.jar" />
        <include name="jboss-osgi-jbossas.jar" />
        <include name="jboss-osgi-spi.jar" />
        <include name="jboss-osgi-vfs.jar" />
        <include name="jboss-osgi-vfs30.jar" />
        <include name="shrinkwrap-api.jar" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib/org.osgi" targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deployers/osgi.deployer" override="true">
        <include name="org.osgi.core.jar" />
      </fileset>

      <!-- deploy/osgi -->
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deploy/osgi" override="true">
        <include name="jboss-osgi-blueprint.jar" />
        <include name="jboss-osgi-common.jar" />
        <include name="jboss-osgi-common-core.jar" />
        <include name="jboss-osgi-http.jar" />
        <include name="jboss-osgi-husky.jar" />
        <include name="jboss-osgi-jaxb.jar" />
        <include name="jboss-osgi-jmx.jar" />
        <include name="jboss-osgi-jndi.jar" />
        <include name="jboss-osgi-reflect.jar" />
        <include name="jboss-osgi-webapp.jar" />
        <include name="jboss-osgi-webconsole.jar" />
        <include name="jboss-osgi-xerces.jar" />
        <include name="jboss-osgi-xml-binding.jar" />
        <include name="org.apache.aries.jmx.jar" />
        <include name="org.apache.aries.util.jar" />
        <include name="org.apache.felix.eventadmin.jar" />
        <include name="org.apache.felix.log.jar" />
      </fileset>
      <fileset dir="@{deploy.artifacts.dir}/lib/org.osgi" targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deploy/osgi" override="true">
        <include name="org.osgi.compendium.jar" />
      </fileset>
      <fileset condition="isJBoss600" dir="@{deploy.artifacts.dir}/resources/jbossas" targetdir="${jbossInstallPath}/server/${jbossTargetServer}/deploy/osgi" override="true">
        <include name="jta-service-jboss-beans.xml" />
      </fileset>

      <!-- Framework Configuration -->

      <singlefile condition="isJBoss600" src="@{deploy.artifacts.dir}/resources/jbossas/jboss600/framework-jboss-beans.xml" target="${jbossInstallPath}/server/${jbossTargetServer}/deployers/osgi.deployer/META-INF/framework-jboss-beans.xml"
        override="true" />
      <singlefile condition="isJBoss601" src="@{deploy.artifacts.dir}/resources/jbossas/jboss601/framework-jboss-beans.xml" target="${jbossInstallPath}/server/${jbossTargetServer}/deployers/osgi.deployer/META-INF/framework-jboss-beans.xml"
        override="true" />
      <singlefile src="@{deploy.artifacts.dir}/lib/framework-core/META-INF/jboss-osgi-bootstrap-system.xml" target="${jbossInstallPath}/server/${jbossTargetServer}/deployers/osgi.deployer/META-INF/framework-system-jboss-beans.xml"
        override="true" />

	  <!-- JBoss-6.0.0.M3 Overwrites -->
      <fileset condition="isJBoss600" dir="@{deploy.artifacts.dir}/lib" targetdir="${jbossInstallPath}/lib"
        override="true">
        <include name="jboss-classloader.jar" />
        <include name="jboss-classloading.jar" />
        <include name="jboss-classloading-spi.jar" />
        <include name="jboss-classloading-vfs.jar" />
      </fileset>
      
    </pack>

    <!--
      ********************************* 
      *                               *
      * JBossAS Overwrites            *
      *                               *
      *********************************
    -->

    <!-- 
       This pack MUST NOT be part of an JBoss OSGi release 
    - ->
    <pack name="JBossMC SNAPSHOT overwrites" required="no" preselected="yes">
      <description>Temporarily overwrite AS provided jars with SNAPSHOT versions</description>
      
      <fileset dir="@{deploy.artifacts.dir}/lib" targetdir="${jbossInstallPath}/lib"
        override="true">
        <include name="jboss-classloader.jar" />
        <include name="jboss-classloading.jar" />
        <include name="jboss-classloading-spi.jar" />
        <include name="jboss-classloading-vfs.jar" />
      </fileset>
    </pack>
    -->
    
  </packs>
</installation>