<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties/>
  <scm class="hudson.scm.SubversionSCM">
    <locations>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://svn.jboss.org/repos/jbossas/trunk</remote>
        <local>jbossas</local>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>@hudson.osgi.url@</remote>
        <local>jboss-osgi</local>
      </hudson.scm.SubversionSCM_-ModuleLocation>
    </locations>
    <useUpdate>true</useUpdate>
    <browser class="hudson.scm.browsers.FishEyeSVN">
      <url>http://fisheye.jboss.com/browse/JBossAS/</url>
      <rootModule></rootModule>
    </browser>
    <excludedRegions></excludedRegions>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <jdk>jdk1.6</jdk>
  <triggers class="vector">
    <hudson.triggers.TimerTrigger>
      <spec>0 22 * * *</spec>
    </hudson.triggers.TimerTrigger>
  </triggers>
  <builders>
    <hudson.tasks.Shell>
      <command>
OSGIDIR=$WORKSPACE/jboss-osgi
HUDSONDIR=$OSGIDIR/hudson
HUDSONBIN=$HUDSONDIR/hudson-home/bin
      
JBOSS_VERSION=jboss-6.0.0-SNAPSHOT
SERVER_NAME=osgi

JBOSS_HOME=$WORKSPACE/jbossas/build/target/$JBOSS_VERSION
JBOSS_ZIP=$HUDSON_HOME/../jboss/$JBOSS_VERSION.zip
JBOSS_BINDADDR=@jboss.bind.address@

# 
# Build JBoss
# 
cd jbossas
mvn clean install

#
# Start JBossAS
#
cp --backup $HUDSONBIN/run-with-pid.sh $JBOSS_HOME/bin/run.sh
$HUDSONBIN/startup.sh $JBOSS_HOME start $SERVER_NAME $JBOSS_BINDADDR

# 
# Was it successfully started?
#
$HUDSONBIN/http-spider.sh $JBOSS_BINDADDR:8090/jboss-osgi $WORKSPACE
if [ -e $WORKSPACE/spider.failed ]; then
  tail -n 200 $JBOSS_HOME/server/default/log/server.log
  $HUDSONBIN/startup.sh $JBOSS_HOME stop
  exit 1
fi

# 
# Remove existing jboss.zip
# 
rm -f $JBOSS_ZIP

# 
# Create new jboss.zip
# 
cd $JBOSS_HOME/..
zip -r $JBOSS_ZIP $JBOSS_VERSION/*

      </command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>